#include "Point4D.h"
#include "Transform.h"
#include <algorithm>
#include <cstdlib>
#include <gtest/gtest.h>
#include <iostream>

#include <cmath>
#include "utils.h"

TEST(BlockSegmentation, segmentation_into_16_equal_parts) {
    std::vector from_shape {4, 4, 4, 4};
    std::vector first_shape {2, 2, 2, 2};
    const int SIZE = 256;
    float block[SIZE] = {0};
    float seg_block[SIZE] = {0};

    int count_block[16] = {0};

    float *pblock = block;
    for (int v = 0; v < from_shape[3]; v++)
        for (int u = 0; u < from_shape[2]; u++)
            for (int y = 0; y < from_shape[1]; y++)
                for (int x = 0; x < from_shape[0]; x++) {
                    int num = (x >= 2) + ((y >= 2) << 1) + ((u >= 2) << 2) + ((v >= 2) << 3);
                    *pblock++ = num;
                    count_block[num]++;
                }

    segment_block(block, from_shape, seg_block, 1);
    float prev = seg_block[0];
    int counter = 1;
    int block_number = 0;
    for (int i = 1; i < SIZE; i++) {
        if (seg_block[i] == prev) {
            counter++;
        } else {
            ASSERT_EQ(count_block[block_number], counter) << block_number << " " << i;
            counter = 1;
            prev = seg_block[i];
            block_number++;
        }
    }
}

TEST(BlockSegmentation, segmentation_into_16_irregular_parts_2) {
    std::vector from_shape {5, 4, 4, 4};
    std::vector first_shape {3, 2, 2, 2};
    const int SIZE = 5 * 5 * 6 * 6;
    float block[SIZE] = {0};
    float seg_block[SIZE] = {0};
    int count_block[16] = {0};

    float *pblock = block;
    for (int v = 0; v < from_shape[3]; v++)
        for (int u = 0; u < from_shape[2]; u++)
            for (int y = 0; y < from_shape[1]; y++)
                for (int x = 0; x < from_shape[0]; x++) {
                    int num = (x >= 3) + ((y >= 2) << 1) + ((u >= 2) << 2) + ((v >= 2) << 3);
                    *pblock++ = num;
                    count_block[num]++;
                }

    segment_block(block, from_shape, seg_block, 1);
    float prev = seg_block[0];
    int counter = 1;
    int block_number = 0;
    for (int i = 1; i < SIZE; i++) {
        if (seg_block[i] == prev) {
            counter++;
        } else {
            ASSERT_EQ(count_block[block_number], counter) << block_number << " " << i;
            counter = 1;
            prev = seg_block[i];
            block_number++;
        }
    }
}

TEST(BlockSegmentation, segment_join_2) {
    std::vector from_shape {4, 4, 4, 4};
    std::vector first_shape {2, 2, 2, 2};
    const int SIZE = 256;
    float block[SIZE] = {0};
    float seg_block[SIZE] = {0};
    float rec_block[SIZE] = {0};

    float *pblock = block;
    for (int v = 0; v < from_shape[3]; v++)
        for (int u = 0; u < from_shape[2]; u++)
            for (int y = 0; y < from_shape[1]; y++)
                for (int x = 0; x < from_shape[0]; x++) {
                    int num = (x >= 2) + ((y >= 2) << 1) + ((u >= 2) << 2) + ((v >= 2) << 3);
                    *pblock++ = num;
                }

    segment_block(block, from_shape, seg_block, 1);
    join_segments(seg_block, from_shape, rec_block, 1);

    for (int i = 0; i < SIZE; i++)
        ASSERT_EQ(block[i], rec_block[i]);
}

TEST(BlockSegmentation, join_irregular) {
    std::vector from_shape {5, 5, 6, 6};
    std::vector first_shape {3, 3, 3, 3};
    const int SIZE = 5 * 5 * 6 * 6;
    float block[SIZE] = {0};
    float seg_block[SIZE] = {0};
    float rec_block[SIZE] = {0};

    for (int i = 0; i < SIZE; i++)
        block[i] = i;

    segment_block(block, from_shape, seg_block, 1);
    join_segments(seg_block, from_shape, rec_block, 1);

    for (int i = 0; i < SIZE; i++)
        ASSERT_EQ(block[i], rec_block[i]);
    // delete_segments(&segments, &seg_shapes, seg_count);
}

TEST(BlockSegmentation, two_levels_of_segmentation) {
    float first_orthant[256] = {
    0,     1,     2,     3,     16,    17,    18,    19,    32,    33,    34,    35,    48,
    49,    50,    51,    256,   257,   258,   259,   272,   273,   274,   275,   288,   289,
    290,   291,   304,   305,   306,   307,   512,   513,   514,   515,   528,   529,   530,
    531,   544,   545,   546,   547,   560,   561,   562,   563,   768,   769,   770,   771,
    784,   785,   786,   787,   800,   801,   802,   803,   816,   817,   818,   819,   4096,
    4097,  4098,  4099,  4112,  4113,  4114,  4115,  4128,  4129,  4130,  4131,  4144,  4145,
    4146,  4147,  4352,  4353,  4354,  4355,  4368,  4369,  4370,  4371,  4384,  4385,  4386,
    4387,  4400,  4401,  4402,  4403,  4608,  4609,  4610,  4611,  4624,  4625,  4626,  4627,
    4640,  4641,  4642,  4643,  4656,  4657,  4658,  4659,  4864,  4865,  4866,  4867,  4880,
    4881,  4882,  4883,  4896,  4897,  4898,  4899,  4912,  4913,  4914,  4915,  8192,  8193,
    8194,  8195,  8208,  8209,  8210,  8211,  8224,  8225,  8226,  8227,  8240,  8241,  8242,
    8243,  8448,  8449,  8450,  8451,  8464,  8465,  8466,  8467,  8480,  8481,  8482,  8483,
    8496,  8497,  8498,  8499,  8704,  8705,  8706,  8707,  8720,  8721,  8722,  8723,  8736,
    8737,  8738,  8739,  8752,  8753,  8754,  8755,  8960,  8961,  8962,  8963,  8976,  8977,
    8978,  8979,  8992,  8993,  8994,  8995,  9008,  9009,  9010,  9011,  12288, 12289, 12290,
    12291, 12304, 12305, 12306, 12307, 12320, 12321, 12322, 12323, 12336, 12337, 12338, 12339,
    12544, 12545, 12546, 12547, 12560, 12561, 12562, 12563, 12576, 12577, 12578, 12579, 12592,
    12593, 12594, 12595, 12800, 12801, 12802, 12803, 12816, 12817, 12818, 12819, 12832, 12833,
    12834, 12835, 12848, 12849, 12850, 12851, 13056, 13057, 13058, 13059, 13072, 13073, 13074,
    13075, 13088, 13089, 13090, 13091, 13104, 13105, 13106, 13107};

    constexpr int SIZE = 16 * 16 * 16 * 16;
    std::vector shape {16, 16, 16, 16};

    float block[SIZE];
    float block_l1[SIZE] = {0};
    float block_l2[SIZE] = {0};

    for (int i = 0; i < SIZE; i++)
        block[i] = i;

    segment_block(block, shape, block_l1, 1);
    segment_block(block, shape, block_l2, 2);

    for (int i = 0; i < 256; i++)
        ASSERT_EQ(block_l2[i], first_orthant[i]);
}

TEST(BlockSegmentation, DISABLED_two_levels_of_segmentation_irregular) {
    float first_orthant[3136] = {
    0,     1,     2,     3,     4,     5,     6,     13,    14,    15,    16,    17,    18,
    19,    26,    27,    28,    29,    30,    31,    32,    39,    40,    41,    42,    43,
    44,    45,    52,    53,    54,    55,    56,    57,    58,    65,    66,    67,    68,
    69,    70,    71,    78,    79,    80,    81,    82,    83,    84,    169,   170,   171,
    172,   173,   174,   175,   182,   183,   184,   185,   186,   187,   188,   195,   196,
    197,   198,   199,   200,   201,   208,   209,   210,   211,   212,   213,   214,   221,
    222,   223,   224,   225,   226,   227,   234,   235,   236,   237,   238,   239,   240,
    247,   248,   249,   250,   251,   252,   253,   338,   339,   340,   341,   342,   343,
    344,   351,   352,   353,   354,   355,   356,   357,   364,   365,   366,   367,   368,
    369,   370,   377,   378,   379,   380,   381,   382,   383,   390,   391,   392,   393,
    394,   395,   396,   403,   404,   405,   406,   407,   408,   409,   416,   417,   418,
    419,   420,   421,   422,   507,   508,   509,   510,   511,   512,   513,   520,   521,
    522,   523,   524,   525,   526,   533,   534,   535,   536,   537,   538,   539,   546,
    547,   548,   549,   550,   551,   552,   559,   560,   561,   562,   563,   564,   565,
    572,   573,   574,   575,   576,   577,   578,   585,   586,   587,   588,   589,   590,
    591,   676,   677,   678,   679,   680,   681,   682,   689,   690,   691,   692,   693,
    694,   695,   702,   703,   704,   705,   706,   707,   708,   715,   716,   717,   718,
    719,   720,   721,   728,   729,   730,   731,   732,   733,   734,   741,   742,   743,
    744,   745,   746,   747,   754,   755,   756,   757,   758,   759,   760,   845,   846,
    847,   848,   849,   850,   851,   858,   859,   860,   861,   862,   863,   864,   871,
    872,   873,   874,   875,   876,   877,   884,   885,   886,   887,   888,   889,   890,
    897,   898,   899,   900,   901,   902,   903,   910,   911,   912,   913,   914,   915,
    916,   923,   924,   925,   926,   927,   928,   929,   1014,  1015,  1016,  1017,  1018,
    1019,  1020,  1027,  1028,  1029,  1030,  1031,  1032,  1033,  1040,  1041,  1042,  1043,
    1044,  1045,  1046,  1053,  1054,  1055,  1056,  1057,  1058,  1059,  1066,  1067,  1068,
    1069,  1070,  1071,  1072,  1079,  1080,  1081,  1082,  1083,  1084,  1085,  1092,  1093,
    1094,  1095,  1096,  1097,  1098,  1183,  1184,  1185,  1186,  1187,  1188,  1189,  1196,
    1197,  1198,  1199,  1200,  1201,  1202,  1209,  1210,  1211,  1212,  1213,  1214,  1215,
    1222,  1223,  1224,  1225,  1226,  1227,  1228,  1235,  1236,  1237,  1238,  1239,  1240,
    1241,  1248,  1249,  1250,  1251,  1252,  1253,  1254,  1261,  1262,  1263,  1264,  1265,
    1266,  1267,  2535,  2536,  2537,  2538,  2539,  2540,  2541,  2548,  2549,  2550,  2551,
    2552,  2553,  2554,  2561,  2562,  2563,  2564,  2565,  2566,  2567,  2574,  2575,  2576,
    2577,  2578,  2579,  2580,  2587,  2588,  2589,  2590,  2591,  2592,  2593,  2600,  2601,
    2602,  2603,  2604,  2605,  2606,  2613,  2614,  2615,  2616,  2617,  2618,  2619,  2704,
    2705,  2706,  2707,  2708,  2709,  2710,  2717,  2718,  2719,  2720,  2721,  2722,  2723,
    2730,  2731,  2732,  2733,  2734,  2735,  2736,  2743,  2744,  2745,  2746,  2747,  2748,
    2749,  2756,  2757,  2758,  2759,  2760,  2761,  2762,  2769,  2770,  2771,  2772,  2773,
    2774,  2775,  2782,  2783,  2784,  2785,  2786,  2787,  2788,  2873,  2874,  2875,  2876,
    2877,  2878,  2879,  2886,  2887,  2888,  2889,  2890,  2891,  2892,  2899,  2900,  2901,
    2902,  2903,  2904,  2905,  2912,  2913,  2914,  2915,  2916,  2917,  2918,  2925,  2926,
    2927,  2928,  2929,  2930,  2931,  2938,  2939,  2940,  2941,  2942,  2943,  2944,  2951,
    2952,  2953,  2954,  2955,  2956,  2957,  3042,  3043,  3044,  3045,  3046,  3047,  3048,
    3055,  3056,  3057,  3058,  3059,  3060,  3061,  3068,  3069,  3070,  3071,  3072,  3073,
    3074,  3081,  3082,  3083,  3084,  3085,  3086,  3087,  3094,  3095,  3096,  3097,  3098,
    3099,  3100,  3107,  3108,  3109,  3110,  3111,  3112,  3113,  3120,  3121,  3122,  3123,
    3124,  3125,  3126,  3211,  3212,  3213,  3214,  3215,  3216,  3217,  3224,  3225,  3226,
    3227,  3228,  3229,  3230,  3237,  3238,  3239,  3240,  3241,  3242,  3243,  3250,  3251,
    3252,  3253,  3254,  3255,  3256,  3263,  3264,  3265,  3266,  3267,  3268,  3269,  3276,
    3277,  3278,  3279,  3280,  3281,  3282,  3289,  3290,  3291,  3292,  3293,  3294,  3295,
    3380,  3381,  3382,  3383,  3384,  3385,  3386,  3393,  3394,  3395,  3396,  3397,  3398,
    3399,  3406,  3407,  3408,  3409,  3410,  3411,  3412,  3419,  3420,  3421,  3422,  3423,
    3424,  3425,  3432,  3433,  3434,  3435,  3436,  3437,  3438,  3445,  3446,  3447,  3448,
    3449,  3450,  3451,  3458,  3459,  3460,  3461,  3462,  3463,  3464,  3549,  3550,  3551,
    3552,  3553,  3554,  3555,  3562,  3563,  3564,  3565,  3566,  3567,  3568,  3575,  3576,
    3577,  3578,  3579,  3580,  3581,  3588,  3589,  3590,  3591,  3592,  3593,  3594,  3601,
    3602,  3603,  3604,  3605,  3606,  3607,  3614,  3615,  3616,  3617,  3618,  3619,  3620,
    3627,  3628,  3629,  3630,  3631,  3632,  3633,  3718,  3719,  3720,  3721,  3722,  3723,
    3724,  3731,  3732,  3733,  3734,  3735,  3736,  3737,  3744,  3745,  3746,  3747,  3748,
    3749,  3750,  3757,  3758,  3759,  3760,  3761,  3762,  3763,  3770,  3771,  3772,  3773,
    3774,  3775,  3776,  3783,  3784,  3785,  3786,  3787,  3788,  3789,  3796,  3797,  3798,
    3799,  3800,  3801,  3802,  5070,  5071,  5072,  5073,  5074,  5075,  5076,  5083,  5084,
    5085,  5086,  5087,  5088,  5089,  5096,  5097,  5098,  5099,  5100,  5101,  5102,  5109,
    5110,  5111,  5112,  5113,  5114,  5115,  5122,  5123,  5124,  5125,  5126,  5127,  5128,
    5135,  5136,  5137,  5138,  5139,  5140,  5141,  5148,  5149,  5150,  5151,  5152,  5153,
    5154,  5239,  5240,  5241,  5242,  5243,  5244,  5245,  5252,  5253,  5254,  5255,  5256,
    5257,  5258,  5265,  5266,  5267,  5268,  5269,  5270,  5271,  5278,  5279,  5280,  5281,
    5282,  5283,  5284,  5291,  5292,  5293,  5294,  5295,  5296,  5297,  5304,  5305,  5306,
    5307,  5308,  5309,  5310,  5317,  5318,  5319,  5320,  5321,  5322,  5323,  5408,  5409,
    5410,  5411,  5412,  5413,  5414,  5421,  5422,  5423,  5424,  5425,  5426,  5427,  5434,
    5435,  5436,  5437,  5438,  5439,  5440,  5447,  5448,  5449,  5450,  5451,  5452,  5453,
    5460,  5461,  5462,  5463,  5464,  5465,  5466,  5473,  5474,  5475,  5476,  5477,  5478,
    5479,  5486,  5487,  5488,  5489,  5490,  5491,  5492,  5577,  5578,  5579,  5580,  5581,
    5582,  5583,  5590,  5591,  5592,  5593,  5594,  5595,  5596,  5603,  5604,  5605,  5606,
    5607,  5608,  5609,  5616,  5617,  5618,  5619,  5620,  5621,  5622,  5629,  5630,  5631,
    5632,  5633,  5634,  5635,  5642,  5643,  5644,  5645,  5646,  5647,  5648,  5655,  5656,
    5657,  5658,  5659,  5660,  5661,  5746,  5747,  5748,  5749,  5750,  5751,  5752,  5759,
    5760,  5761,  5762,  5763,  5764,  5765,  5772,  5773,  5774,  5775,  5776,  5777,  5778,
    5785,  5786,  5787,  5788,  5789,  5790,  5791,  5798,  5799,  5800,  5801,  5802,  5803,
    5804,  5811,  5812,  5813,  5814,  5815,  5816,  5817,  5824,  5825,  5826,  5827,  5828,
    5829,  5830,  5915,  5916,  5917,  5918,  5919,  5920,  5921,  5928,  5929,  5930,  5931,
    5932,  5933,  5934,  5941,  5942,  5943,  5944,  5945,  5946,  5947,  5954,  5955,  5956,
    5957,  5958,  5959,  5960,  5967,  5968,  5969,  5970,  5971,  5972,  5973,  5980,  5981,
    5982,  5983,  5984,  5985,  5986,  5993,  5994,  5995,  5996,  5997,  5998,  5999,  6084,
    6085,  6086,  6087,  6088,  6089,  6090,  6097,  6098,  6099,  6100,  6101,  6102,  6103,
    6110,  6111,  6112,  6113,  6114,  6115,  6116,  6123,  6124,  6125,  6126,  6127,  6128,
    6129,  6136,  6137,  6138,  6139,  6140,  6141,  6142,  6149,  6150,  6151,  6152,  6153,
    6154,  6155,  6162,  6163,  6164,  6165,  6166,  6167,  6168,  6253,  6254,  6255,  6256,
    6257,  6258,  6259,  6266,  6267,  6268,  6269,  6270,  6271,  6272,  6279,  6280,  6281,
    6282,  6283,  6284,  6285,  6292,  6293,  6294,  6295,  6296,  6297,  6298,  6305,  6306,
    6307,  6308,  6309,  6310,  6311,  6318,  6319,  6320,  6321,  6322,  6323,  6324,  6331,
    6332,  6333,  6334,  6335,  6336,  6337,  7605,  7606,  7607,  7608,  7609,  7610,  7611,
    7618,  7619,  7620,  7621,  7622,  7623,  7624,  7631,  7632,  7633,  7634,  7635,  7636,
    7637,  7644,  7645,  7646,  7647,  7648,  7649,  7650,  7657,  7658,  7659,  7660,  7661,
    7662,  7663,  7670,  7671,  7672,  7673,  7674,  7675,  7676,  7683,  7684,  7685,  7686,
    7687,  7688,  7689,  7774,  7775,  7776,  7777,  7778,  7779,  7780,  7787,  7788,  7789,
    7790,  7791,  7792,  7793,  7800,  7801,  7802,  7803,  7804,  7805,  7806,  7813,  7814,
    7815,  7816,  7817,  7818,  7819,  7826,  7827,  7828,  7829,  7830,  7831,  7832,  7839,
    7840,  7841,  7842,  7843,  7844,  7845,  7852,  7853,  7854,  7855,  7856,  7857,  7858,
    7943,  7944,  7945,  7946,  7947,  7948,  7949,  7956,  7957,  7958,  7959,  7960,  7961,
    7962,  7969,  7970,  7971,  7972,  7973,  7974,  7975,  7982,  7983,  7984,  7985,  7986,
    7987,  7988,  7995,  7996,  7997,  7998,  7999,  8000,  8001,  8008,  8009,  8010,  8011,
    8012,  8013,  8014,  8021,  8022,  8023,  8024,  8025,  8026,  8027,  8112,  8113,  8114,
    8115,  8116,  8117,  8118,  8125,  8126,  8127,  8128,  8129,  8130,  8131,  8138,  8139,
    8140,  8141,  8142,  8143,  8144,  8151,  8152,  8153,  8154,  8155,  8156,  8157,  8164,
    8165,  8166,  8167,  8168,  8169,  8170,  8177,  8178,  8179,  8180,  8181,  8182,  8183,
    8190,  8191,  8192,  8193,  8194,  8195,  8196,  8281,  8282,  8283,  8284,  8285,  8286,
    8287,  8294,  8295,  8296,  8297,  8298,  8299,  8300,  8307,  8308,  8309,  8310,  8311,
    8312,  8313,  8320,  8321,  8322,  8323,  8324,  8325,  8326,  8333,  8334,  8335,  8336,
    8337,  8338,  8339,  8346,  8347,  8348,  8349,  8350,  8351,  8352,  8359,  8360,  8361,
    8362,  8363,  8364,  8365,  8450,  8451,  8452,  8453,  8454,  8455,  8456,  8463,  8464,
    8465,  8466,  8467,  8468,  8469,  8476,  8477,  8478,  8479,  8480,  8481,  8482,  8489,
    8490,  8491,  8492,  8493,  8494,  8495,  8502,  8503,  8504,  8505,  8506,  8507,  8508,
    8515,  8516,  8517,  8518,  8519,  8520,  8521,  8528,  8529,  8530,  8531,  8532,  8533,
    8534,  8619,  8620,  8621,  8622,  8623,  8624,  8625,  8632,  8633,  8634,  8635,  8636,
    8637,  8638,  8645,  8646,  8647,  8648,  8649,  8650,  8651,  8658,  8659,  8660,  8661,
    8662,  8663,  8664,  8671,  8672,  8673,  8674,  8675,  8676,  8677,  8684,  8685,  8686,
    8687,  8688,  8689,  8690,  8697,  8698,  8699,  8700,  8701,  8702,  8703,  8788,  8789,
    8790,  8791,  8792,  8793,  8794,  8801,  8802,  8803,  8804,  8805,  8806,  8807,  8814,
    8815,  8816,  8817,  8818,  8819,  8820,  8827,  8828,  8829,  8830,  8831,  8832,  8833,
    8840,  8841,  8842,  8843,  8844,  8845,  8846,  8853,  8854,  8855,  8856,  8857,  8858,
    8859,  8866,  8867,  8868,  8869,  8870,  8871,  8872,  10140, 10141, 10142, 10143, 10144,
    10145, 10146, 10153, 10154, 10155, 10156, 10157, 10158, 10159, 10166, 10167, 10168, 10169,
    10170, 10171, 10172, 10179, 10180, 10181, 10182, 10183, 10184, 10185, 10192, 10193, 10194,
    10195, 10196, 10197, 10198, 10205, 10206, 10207, 10208, 10209, 10210, 10211, 10218, 10219,
    10220, 10221, 10222, 10223, 10224, 10309, 10310, 10311, 10312, 10313, 10314, 10315, 10322,
    10323, 10324, 10325, 10326, 10327, 10328, 10335, 10336, 10337, 10338, 10339, 10340, 10341,
    10348, 10349, 10350, 10351, 10352, 10353, 10354, 10361, 10362, 10363, 10364, 10365, 10366,
    10367, 10374, 10375, 10376, 10377, 10378, 10379, 10380, 10387, 10388, 10389, 10390, 10391,
    10392, 10393, 10478, 10479, 10480, 10481, 10482, 10483, 10484, 10491, 10492, 10493, 10494,
    10495, 10496, 10497, 10504, 10505, 10506, 10507, 10508, 10509, 10510, 10517, 10518, 10519,
    10520, 10521, 10522, 10523, 10530, 10531, 10532, 10533, 10534, 10535, 10536, 10543, 10544,
    10545, 10546, 10547, 10548, 10549, 10556, 10557, 10558, 10559, 10560, 10561, 10562, 10647,
    10648, 10649, 10650, 10651, 10652, 10653, 10660, 10661, 10662, 10663, 10664, 10665, 10666,
    10673, 10674, 10675, 10676, 10677, 10678, 10679, 10686, 10687, 10688, 10689, 10690, 10691,
    10692, 10699, 10700, 10701, 10702, 10703, 10704, 10705, 10712, 10713, 10714, 10715, 10716,
    10717, 10718, 10725, 10726, 10727, 10728, 10729, 10730, 10731, 10816, 10817, 10818, 10819,
    10820, 10821, 10822, 10829, 10830, 10831, 10832, 10833, 10834, 10835, 10842, 10843, 10844,
    10845, 10846, 10847, 10848, 10855, 10856, 10857, 10858, 10859, 10860, 10861, 10868, 10869,
    10870, 10871, 10872, 10873, 10874, 10881, 10882, 10883, 10884, 10885, 10886, 10887, 10894,
    10895, 10896, 10897, 10898, 10899, 10900, 10985, 10986, 10987, 10988, 10989, 10990, 10991,
    10998, 10999, 11000, 11001, 11002, 11003, 11004, 11011, 11012, 11013, 11014, 11015, 11016,
    11017, 11024, 11025, 11026, 11027, 11028, 11029, 11030, 11037, 11038, 11039, 11040, 11041,
    11042, 11043, 11050, 11051, 11052, 11053, 11054, 11055, 11056, 11063, 11064, 11065, 11066,
    11067, 11068, 11069, 11154, 11155, 11156, 11157, 11158, 11159, 11160, 11167, 11168, 11169,
    11170, 11171, 11172, 11173, 11180, 11181, 11182, 11183, 11184, 11185, 11186, 11193, 11194,
    11195, 11196, 11197, 11198, 11199, 11206, 11207, 11208, 11209, 11210, 11211, 11212, 11219,
    11220, 11221, 11222, 11223, 11224, 11225, 11232, 11233, 11234, 11235, 11236, 11237, 11238,
    11323, 11324, 11325, 11326, 11327, 11328, 11329, 11336, 11337, 11338, 11339, 11340, 11341,
    11342, 11349, 11350, 11351, 11352, 11353, 11354, 11355, 11362, 11363, 11364, 11365, 11366,
    11367, 11368, 11375, 11376, 11377, 11378, 11379, 11380, 11381, 11388, 11389, 11390, 11391,
    11392, 11393, 11394, 11401, 11402, 11403, 11404, 11405, 11406, 11407, 12675, 12676, 12677,
    12678, 12679, 12680, 12681, 12688, 12689, 12690, 12691, 12692, 12693, 12694, 12701, 12702,
    12703, 12704, 12705, 12706, 12707, 12714, 12715, 12716, 12717, 12718, 12719, 12720, 12727,
    12728, 12729, 12730, 12731, 12732, 12733, 12740, 12741, 12742, 12743, 12744, 12745, 12746,
    12753, 12754, 12755, 12756, 12757, 12758, 12759, 12844, 12845, 12846, 12847, 12848, 12849,
    12850, 12857, 12858, 12859, 12860, 12861, 12862, 12863, 12870, 12871, 12872, 12873, 12874,
    12875, 12876, 12883, 12884, 12885, 12886, 12887, 12888, 12889, 12896, 12897, 12898, 12899,
    12900, 12901, 12902, 12909, 12910, 12911, 12912, 12913, 12914, 12915, 12922, 12923, 12924,
    12925, 12926, 12927, 12928, 13013, 13014, 13015, 13016, 13017, 13018, 13019, 13026, 13027,
    13028, 13029, 13030, 13031, 13032, 13039, 13040, 13041, 13042, 13043, 13044, 13045, 13052,
    13053, 13054, 13055, 13056, 13057, 13058, 13065, 13066, 13067, 13068, 13069, 13070, 13071,
    13078, 13079, 13080, 13081, 13082, 13083, 13084, 13091, 13092, 13093, 13094, 13095, 13096,
    13097, 13182, 13183, 13184, 13185, 13186, 13187, 13188, 13195, 13196, 13197, 13198, 13199,
    13200, 13201, 13208, 13209, 13210, 13211, 13212, 13213, 13214, 13221, 13222, 13223, 13224,
    13225, 13226, 13227, 13234, 13235, 13236, 13237, 13238, 13239, 13240, 13247, 13248, 13249,
    13250, 13251, 13252, 13253, 13260, 13261, 13262, 13263, 13264, 13265, 13266, 13351, 13352,
    13353, 13354, 13355, 13356, 13357, 13364, 13365, 13366, 13367, 13368, 13369, 13370, 13377,
    13378, 13379, 13380, 13381, 13382, 13383, 13390, 13391, 13392, 13393, 13394, 13395, 13396,
    13403, 13404, 13405, 13406, 13407, 13408, 13409, 13416, 13417, 13418, 13419, 13420, 13421,
    13422, 13429, 13430, 13431, 13432, 13433, 13434, 13435, 13520, 13521, 13522, 13523, 13524,
    13525, 13526, 13533, 13534, 13535, 13536, 13537, 13538, 13539, 13546, 13547, 13548, 13549,
    13550, 13551, 13552, 13559, 13560, 13561, 13562, 13563, 13564, 13565, 13572, 13573, 13574,
    13575, 13576, 13577, 13578, 13585, 13586, 13587, 13588, 13589, 13590, 13591, 13598, 13599,
    13600, 13601, 13602, 13603, 13604, 13689, 13690, 13691, 13692, 13693, 13694, 13695, 13702,
    13703, 13704, 13705, 13706, 13707, 13708, 13715, 13716, 13717, 13718, 13719, 13720, 13721,
    13728, 13729, 13730, 13731, 13732, 13733, 13734, 13741, 13742, 13743, 13744, 13745, 13746,
    13747, 13754, 13755, 13756, 13757, 13758, 13759, 13760, 13767, 13768, 13769, 13770, 13771,
    13772, 13773, 13858, 13859, 13860, 13861, 13862, 13863, 13864, 13871, 13872, 13873, 13874,
    13875, 13876, 13877, 13884, 13885, 13886, 13887, 13888, 13889, 13890, 13897, 13898, 13899,
    13900, 13901, 13902, 13903, 13910, 13911, 13912, 13913, 13914, 13915, 13916, 13923, 13924,
    13925, 13926, 13927, 13928, 13929, 13936, 13937, 13938, 13939, 13940, 13941, 13942, 15210,
    15211, 15212, 15213, 15214, 15215, 15216, 15223, 15224, 15225, 15226, 15227, 15228, 15229,
    15236, 15237, 15238, 15239, 15240, 15241, 15242, 15249, 15250, 15251, 15252, 15253, 15254,
    15255, 15262, 15263, 15264, 15265, 15266, 15267, 15268, 15275, 15276, 15277, 15278, 15279,
    15280, 15281, 15288, 15289, 15290, 15291, 15292, 15293, 15294, 15379, 15380, 15381, 15382,
    15383, 15384, 15385, 15392, 15393, 15394, 15395, 15396, 15397, 15398, 15405, 15406, 15407,
    15408, 15409, 15410, 15411, 15418, 15419, 15420, 15421, 15422, 15423, 15424, 15431, 15432,
    15433, 15434, 15435, 15436, 15437, 15444, 15445, 15446, 15447, 15448, 15449, 15450, 15457,
    15458, 15459, 15460, 15461, 15462, 15463, 15548, 15549, 15550, 15551, 15552, 15553, 15554,
    15561, 15562, 15563, 15564, 15565, 15566, 15567, 15574, 15575, 15576, 15577, 15578, 15579,
    15580, 15587, 15588, 15589, 15590, 15591, 15592, 15593, 15600, 15601, 15602, 15603, 15604,
    15605, 15606, 15613, 15614, 15615, 15616, 15617, 15618, 15619, 15626, 15627, 15628, 15629,
    15630, 15631, 15632, 15717, 15718, 15719, 15720, 15721, 15722, 15723, 15730, 15731, 15732,
    15733, 15734, 15735, 15736, 15743, 15744, 15745, 15746, 15747, 15748, 15749, 15756, 15757,
    15758, 15759, 15760, 15761, 15762, 15769, 15770, 15771, 15772, 15773, 15774, 15775, 15782,
    15783, 15784, 15785, 15786, 15787, 15788, 15795, 15796, 15797, 15798, 15799, 15800, 15801,
    15886, 15887, 15888, 15889, 15890, 15891, 15892, 15899, 15900, 15901, 15902, 15903, 15904,
    15905, 15912, 15913, 15914, 15915, 15916, 15917, 15918, 15925, 15926, 15927, 15928, 15929,
    15930, 15931, 15938, 15939, 15940, 15941, 15942, 15943, 15944, 15951, 15952, 15953, 15954,
    15955, 15956, 15957, 15964, 15965, 15966, 15967, 15968, 15969, 15970, 16055, 16056, 16057,
    16058, 16059, 16060, 16061, 16068, 16069, 16070, 16071, 16072, 16073, 16074, 16081, 16082,
    16083, 16084, 16085, 16086, 16087, 16094, 16095, 16096, 16097, 16098, 16099, 16100, 16107,
    16108, 16109, 16110, 16111, 16112, 16113, 16120, 16121, 16122, 16123, 16124, 16125, 16126,
    16133, 16134, 16135, 16136, 16137, 16138, 16139, 16224, 16225, 16226, 16227, 16228, 16229,
    16230, 16237, 16238, 16239, 16240, 16241, 16242, 16243, 16250, 16251, 16252, 16253, 16254,
    16255, 16256, 16263, 16264, 16265, 16266, 16267, 16268, 16269, 16276, 16277, 16278, 16279,
    16280, 16281, 16282, 16289, 16290, 16291, 16292, 16293, 16294, 16295, 16302, 16303, 16304,
    16305, 16306, 16307, 16308, 16393, 16394, 16395, 16396, 16397, 16398, 16399, 16406, 16407,
    16408, 16409, 16410, 16411, 16412, 16419, 16420, 16421, 16422, 16423, 16424, 16425, 16432,
    16433, 16434, 16435, 16436, 16437, 16438, 16445, 16446, 16447, 16448, 16449, 16450, 16451,
    16458, 16459, 16460, 16461, 16462, 16463, 16464, 16471, 16472, 16473, 16474, 16475, 16476,
    16477, 17745, 17746, 17747, 17748, 17749, 17750, 17751, 17758, 17759, 17760, 17761, 17762,
    17763, 17764, 17771, 17772, 17773, 17774, 17775, 17776, 17777, 17784, 17785, 17786, 17787,
    17788, 17789, 17790, 17797, 17798, 17799, 17800, 17801, 17802, 17803, 17810, 17811, 17812,
    17813, 17814, 17815, 17816, 17823, 17824, 17825, 17826, 17827, 17828, 17829, 17914, 17915,
    17916, 17917, 17918, 17919, 17920, 17927, 17928, 17929, 17930, 17931, 17932, 17933, 17940,
    17941, 17942, 17943, 17944, 17945, 17946, 17953, 17954, 17955, 17956, 17957, 17958, 17959,
    17966, 17967, 17968, 17969, 17970, 17971, 17972, 17979, 17980, 17981, 17982, 17983, 17984,
    17985, 17992, 17993, 17994, 17995, 17996, 17997, 17998, 18083, 18084, 18085, 18086, 18087,
    18088, 18089, 18096, 18097, 18098, 18099, 18100, 18101, 18102, 18109, 18110, 18111, 18112,
    18113, 18114, 18115, 18122, 18123, 18124, 18125, 18126, 18127, 18128, 18135, 18136, 18137,
    18138, 18139, 18140, 18141, 18148, 18149, 18150, 18151, 18152, 18153, 18154, 18161, 18162,
    18163, 18164, 18165, 18166, 18167, 18252, 18253, 18254, 18255, 18256, 18257, 18258, 18265,
    18266, 18267, 18268, 18269, 18270, 18271, 18278, 18279, 18280, 18281, 18282, 18283, 18284,
    18291, 18292, 18293, 18294, 18295, 18296, 18297, 18304, 18305, 18306, 18307, 18308, 18309,
    18310, 18317, 18318, 18319, 18320, 18321, 18322, 18323, 18330, 18331, 18332, 18333, 18334,
    18335, 18336, 18421, 18422, 18423, 18424, 18425, 18426, 18427, 18434, 18435, 18436, 18437,
    18438, 18439, 18440, 18447, 18448, 18449, 18450, 18451, 18452, 18453, 18460, 18461, 18462,
    18463, 18464, 18465, 18466, 18473, 18474, 18475, 18476, 18477, 18478, 18479, 18486, 18487,
    18488, 18489, 18490, 18491, 18492, 18499, 18500, 18501, 18502, 18503, 18504, 18505, 18590,
    18591, 18592, 18593, 18594, 18595, 18596, 18603, 18604, 18605, 18606, 18607, 18608, 18609,
    18616, 18617, 18618, 18619, 18620, 18621, 18622, 18629, 18630, 18631, 18632, 18633, 18634,
    18635, 18642, 18643, 18644, 18645, 18646, 18647, 18648, 18655, 18656, 18657, 18658, 18659,
    18660, 18661, 18668, 18669, 18670, 18671, 18672, 18673, 18674, 18759, 18760, 18761, 18762,
    18763, 18764, 18765, 18772, 18773, 18774, 18775, 18776, 18777, 18778, 18785, 18786, 18787,
    18788, 18789, 18790, 18791, 18798, 18799, 18800, 18801, 18802, 18803, 18804, 18811, 18812,
    18813, 18814, 18815, 18816, 18817, 18824, 18825, 18826, 18827, 18828, 18829, 18830, 18837,
    18838, 18839, 18840, 18841, 18842, 18843, 18928, 18929, 18930, 18931, 18932, 18933, 18934,
    18941, 18942, 18943, 18944, 18945, 18946, 18947, 18954, 18955, 18956, 18957, 18958, 18959,
    18960, 18967, 18968, 18969, 18970, 18971, 18972, 18973, 18980, 18981, 18982, 18983, 18984,
    18985, 18986, 18993, 18994, 18995, 18996, 18997, 18998, 18999, 19006, 19007, 19008, 19009,
    19010, 19011, 19012};

    constexpr int SIZE = 15 * 15 * 13 * 13;
    std::vector shape {15, 15, 13, 13};

    float block[SIZE];
    float block_l1[SIZE] = {0};
    float block_l2[SIZE] = {0};

    for (int i = 0; i < SIZE; i++)
        block[i] = i;
    auto shapes = make_shapes(shape, 2);

    for (const auto& it: shapes) {
        for (const auto& el: it)
            std::cerr << el << " ";
        std::cerr <<std::endl;
    }

    segment_block(block, shape, block_l1, 1);

    for (int i = 0; i < 3136; i++)
        ASSERT_EQ(block_l1[i], first_orthant[i]) << i;
}

